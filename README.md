# Session Agent

## Основная информация

Данное приложение написано с целью хранения информации о сессии текущего окна СПС.

## Стек
Основная архитектура приложения основывается на [WebSocket](https://spring-projects.ru/guides/messaging-stomp-websocket/).

* Java 17
* SpringBoot 3
* WebSocket

## Эндпоинты

Эндпоинты работают по принциппу подписки, клиент подписывается на эндопинт и ждёт от него сообщений. 
<br> Пример реализации общения:
- [Angular agent for connect](./example/session-agent.service.ts)

### **session**
Эндпоинт для отправки и получения информации по текущей сессии

## Сообщения

Так как у нас один эндпоинт, мы через него шлём разные сообщения. 
А клиент в свою очередь должен подписываться на различные сообщения и по разному на них реагировать.

<hr>

**Output** - Сообщения которые приходят со стороны клиента.

**Input** - Сообщения которые приложение отправляет по подписке на клиент.

<hr>

* Session (**Output**) 
  * get - получить текущую сессию
  * create - создать новую сессию
  * healthCheck - сессия мертва (то есть окно было удалено в админке СПС)

## Логика хранения сессий
При запуске PC поднимается настоящие приложение, после чего приложение при старте читает файл из конфиги **session.storage.file.path**
- После чего поднимается браузер с инфокиоском, который смотрит на данное приложение и выполняется запрос **get**
- Затем если сессия есть то просто данная сессия помещается в кеш браузера
- Если сесси нет то клиенту необходимо её создать create
- При этом каждые session.health.check.cron сервер мониторинга СПС опрашивается на предмет валидности сессии
- Если сессия окна была закрыта администратором, то на клиент посылается dead и при этом сессия из файла **session.storage.file.path** удаляется

## Конфигурации
### Internal Config
- session.storage.file.path=./session.data
  - Путь до файла для хранения сессии

### Integration configs
- remote.monitoring.server.url=http://192.168.141.185:8089/
  - Адрес сервиса мониторинга СПС

### Native configs
- server.port=443
  - порт на котором будет поднято приложение
- logging.file.path=./socket.log - название файла лога
- logging.logback.rollingpolicy.max-history=7 - за сколько дней хранить логи
- logging.logback.rollingpolicy.total-size-cap=1GB - колличество хранимых логов